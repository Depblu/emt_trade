# 东方财富证券查询工具使用手册

## 概述

本工具基于对东方财富证券网站网络请求的分析，实现了三个主要查询功能：
1. 资金持仓查询
2. 当日委托查询
3. 当日成交查询

## 使用前准备

### 1. 登录获取会话

在使用查询工具前，必须先进行登录以获取有效的会话信息：

```bash
python emt_login_corrected.py
```

登录成功后，会话信息将保存到 `session.json` 文件中。

### 2. 激活虚拟环境

```bash
source env/bin/activate
```

## 工具使用方法

### 查询资金持仓

```bash
python query_tool.py funds
```

或指定会话文件：

```bash
python query_tool.py funds --session /path/to/session.json
```

输出示例：
```
=== 东方财富证券-查询工具 ===
✅ 会话加载成功

正在查询资金持仓...

=== 资金信息 ===
总资产: 10000.50
可用资金: 8500.25
冻结资金: 1500.00
证券市值: 1500.25
总盈亏: 25.50

=== 持仓信息 ===
证券代码    证券名称      持仓数量   可卖数量   成本价   当前价   市值        盈亏
----------------------------------------------------------------------------------------------------
159991     创大盘ETF     2000       2000       0.750    0.751    1502.00     2.00
```

### 查询当日委托

```bash
python query_tool.py orders
```

输出示例：
```
=== 东方财富证券-查询工具 ===
✅ 会话加载成功

正在查询当日委托...

=== 当日委托 (2条) ===
委托编号         证券代码    证券名称      类型   委托价格 委托数量 成交数量 状态     委托时间
--------------------------------------------------------------------------------------------------------------
202501160001     159991     创大盘ETF     买入   0.750    1000     1000    已成     09:30:15
202501160002     159991     创大盘ETF     卖出   0.751    500      0       已撤     10:15:20
```

### 查询当日成交

```bash
python query_tool.py deals
```

输出示例：
```
=== 东方财富证券-查询工具 ===
✅ 会话加载成功

正在查询当日成交...

=== 当日成交 (1条) ===
成交编号         证券代码    证券名称      类型   成交价格 成交数量 成交金额     成交时间
--------------------------------------------------------------------------------------------------------------
202501160001     159991     创大盘ETF     买入   0.750    1000     750.00      09:30:15
```

### 查询全部信息

```bash
python query_tool.py all
```

### 保存结果到文件

```bash
python query_tool.py all --output query_results.json
```

## 技术实现说明

### 1. 资金持仓查询

**接口URL**: `https://jywg.18.cn/Com/queryAssetAndPositionV1?validatekey={validatekey}`

**请求方法**: POST

**请求参数**:
- `moneyType`: RMB (查询人民币账户)

**数据结构**:
- 总资产、可用资金、冻结资金、证券市值、总盈亏
- 持仓列表：证券代码、名称、持仓数量、可卖数量、成本价、当前价、市值、盈亏

### 2. 当日委托查询

**接口URL**: `https://jywg.18.cn/Search/queryTodayOrderWEB?validatekey={validatekey}`

**请求方法**: POST

**请求参数**:
- `qqhs`: 20 (请求记录数)
- `dwc`: "" (查询条件)

**数据结构**:
- 委托编号、证券代码、名称、委托类型、价格、数量、成交数量、状态、时间

### 3. 当日成交查询

**接口URL**: `https://jywg.18.cn/Search/queryTodayCJWEB?validatekey={validatekey}`

**请求方法**: POST

**请求参数**:
- `qqhs`: 20 (请求记录数)
- `dwc`: "" (查询条件)

**备选方案**: 如果专门的成交接口不可用，从当日委托中提取已成交记录。

## 注意事项

1. **会话有效性**: 登录会话有时效性，如果出现认证失败，需要重新登录
2. **网络环境**: 确保网络连接正常，能够访问东方财富证券网站
3. **数据准确性**: 本工具基于网络请求分析，如网站接口变更可能需要调整
4. **使用频率**: 避免频繁查询，以免触发网站的访问限制

## 错误处理

常见错误及解决方案：

- **会话文件未找到**: 先运行 `emt_login_corrected.py` 登录
- **认证失败**: 会话过期，重新登录
- **网络请求失败**: 检查网络连接和防火墙设置
- **数据解析错误**: 网站接口可能已变更，需要更新解析逻辑

## 扩展功能

可以基于现有框架扩展更多查询功能：
- 历史成交查询
- 股票行情查询
- 银证转账记录
- 新股申购信息

## 安全提醒

1. 不要在公共计算机上保存会话文件
2. 定期更改交易密码
3. 注意保护个人信息和账户安全
4. 仅用于个人合法的证券交易查询